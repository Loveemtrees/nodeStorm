<!doctype html>
<html>
  <head>
    <title>Socket.io Test - STUDENT</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <script>    
      var socket = io();
      var replied = false;
      
      socket.on('date', function(data){
        $('#date').text(data.date);
      });

      $(document).ready(function(){

        // MESSAGE TO HOST------------------------------------

        // check if there's already a question
        socket.emit('check_for_questions', true);
        socket.on('current_question', function (msg){
            if(msg != "") {
                $("#ready_button").removeAttr("disabled");
                $("#questions_active > p").remove();
                $("#questions_active").prepend($("<p>").addClass("lead").text(msg));
            }
        });

        // send reply
        $("form").submit(function () {
            // Build reply locally
            $("#replies").prepend($("<li>").addClass("list-group-item").text($("#m").val()));
            // ... and send to server
            socket.emit("client_message", $("#m").val());
            !replied ? socket.emit("reply_status", true) : "";
            replied = true;
            $("#m").val("");
            return false;
        });
        // Receive Question from host
        socket.on("host_message", function (msg) {
            ready = true;
            replied = false;
            $("#questions_active > p").remove();
            $("#questions_active").prepend($("<p>").addClass("lead").text(msg));
            $("#replies > li").remove();
            $("#questions").prepend($("<li>").addClass("list-group-item").text(msg));
            $("#ready_button").removeAttr("disabled");
        });

    });
    </script>

    <div class="container">
        <div class="header">
            <ul class="nav nav-pills pull-right">
                <li class="text-muted"><h3>STUDENT</h3></li>
            </ul>
            <h3 class="text-muted">Audience Response Brainstorming <small>v0.1.1</small></h3>
        </div>
        <div id="date"></div>
        <div class="jumbotron" id="questions_active">
            <!--<h1>Jumbotron heading</h1>-->
            <p class="lead" id="question_placeholder">Es wurde noch keine Frage gestellt!</p>
            <form class="form-inline" role="form" action="">
                <input id="m" type="text" class="form-control" placeholder="Dazu faellt mir ein ...">
                <button class="btn btn-success" disabled="disabled" id="ready_button">Send</button>
            </form>
        </div>

        <div class="row marketing">
            <div class="col-lg-6">
                <span class="list-head">Erhaltene Fragen</span>
                <!-- Liste der vergangenen Fragen -->
                <ul id="questions" class="list-group"></ul>
            </div>

            <div class="col-lg-6">
                <span class="list-head">Meine Antworten</span>
                <!-- Liste der Antworten -->
                <ul id="replies" class="list-group no-scroll-limit"></ul>
            </div>
        </div>

        <div class="footer">
            <p>&copy; Sebastian Baumgarten 2014</p>
        </div>

    </div> <!-- /container -->
  </body>
</html>